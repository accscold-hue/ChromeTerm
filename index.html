<!DOCTYPE html>
<html>
<head>
  <title>Web Terminal</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: #00ff00;
      font-family: monospace;
      font-size: 16px;
    }

    #terminal {
      padding: 20px;
      max-width: 900px;
      margin: auto;
      white-space: pre-wrap;
      overflow-y: auto;
      height: 100vh;
      box-sizing: border-box;
    }

    .line {
      margin: 2px 0;
    }

    .prompt {
      display: inline;
    }

    input {
      background: black;
      color: #00ff00;
      border: none;
      outline: none;
      font-family: monospace;
      font-size: 16px;
      width: 70%;
    }
  </style>
</head>
<body>

<div id="terminal"></div>

<script>
const terminal = document.getElementById("terminal");

/* ===== Fake filesystem ===== */
const fs = {
  "/": {
    home: {
      user: {
        "notes.txt": "Remember to learn JavaScript.",
        "secret.txt": "Nothing to see here ðŸ‘€"
      }
    },
    "readme.txt": "Welcome to the web terminal."
  }
};

let cwd = "/";
let history = [];
let historyIndex = -1;

/* ===== Utilities ===== */
function scrollBottom() {
  terminal.scrollTop = terminal.scrollHeight;
}

function print(text = "", typing = false) {
  const line = document.createElement("div");
  line.className = "line";
  terminal.appendChild(line);

  if (!typing) {
    line.textContent = text;
    scrollBottom();
    return;
  }

  let i = 0;
  const interval = setInterval(() => {
    line.textContent += text[i++];
    scrollBottom();
    if (i >= text.length) clearInterval(interval);
  }, 15);
}

function resolvePath(path) {
  if (path === "/") return fs["/"];
  const parts = path.split("/").filter(Boolean);
  let node = fs["/"];
  for (const p of parts) {
    if (!node[p]) return null;
    node = node[p];
  }
  return node;
}

function prompt() {
  const line = document.createElement("div");
  line.className = "line";
  line.innerHTML = `<span class="prompt">user@web:${cwd}$ </span><input autofocus>`;
  terminal.appendChild(line);

  const input = line.querySelector("input");
  input.focus();

  input.addEventListener("keydown", e => {
    if (e.key === "ArrowUp") {
      if (history.length) {
        historyIndex = Math.max(0, historyIndex - 1);
        input.value = history[historyIndex];
      }
      e.preventDefault();
    }

    if (e.key === "ArrowDown") {
      if (history.length) {
        historyIndex = Math.min(history.length, historyIndex + 1);
        input.value = history[historyIndex] || "";
      }
      e.preventDefault();
    }

    if (e.key === "Enter") {
      const cmd = input.value.trim();
      history.push(cmd);
      historyIndex = history.length;
      line.remove();
      print(`user@web:${cwd}$ ${cmd}`);
      handleCommand(cmd);
    }
  });
}

/* ===== Commands ===== */
async function handleCommand(cmdLine) {
  if (!cmdLine) {
    prompt();
    return;
  }

  const [cmd, ...args] = cmdLine.split(" ");

  switch (cmd) {
    case "help":
      print("Available commands:", true);
      print(" help      show this help");
      print(" ls        list files");
      print(" cd        change directory");
      print(" pwd       show current path");
      print(" cat       read a file");
      print(" echo      print text");
      print(" whoami    show user");
      print(" ping      test network");
      print(" clear     clear terminal");
      break;

    case "ls": {
      const dir = resolvePath(cwd);
      if (typeof dir !== "object") {
        print("ls: not a directory");
      } else {
        print(Object.keys(dir).join("  "));
      }
      break;
    }

    case "cd": {
      const target = args[0];
      if (!target) break;

      if (target === "..") {
        if (cwd !== "/") {
          cwd = "/" + cwd.split("/").filter(Boolean).slice(0, -1).join("/");
          if (cwd === "") cwd = "/";
        }
      } else {
        const newPath = cwd === "/" ? `/${target}` : `${cwd}/${target}`;
        if (resolvePath(newPath)) cwd = newPath;
        else print("cd: no such directory");
      }
      break;
    }

    case "pwd":
      print(cwd);
      break;

    case "cat": {
      const file = args[0];
      if (!file) {
        print("cat: missing file");
        break;
      }
      const dir = resolvePath(cwd);
      if (typeof dir[file] === "string") {
        print(dir[file], true);
      } else {
        print("cat: file not found");
      }
      break;
    }

    case "echo":
      print(args.join(" "));
      break;

    case "whoami":
      print("user");
      break;

    case "ping":
      print("Pinging server...");
      try {
        const r = await fetch("https://api.github.com/zen");
        const t = await r.text();
        print("Reply: " + t);
      } catch {
        print("Ping failed.");
      }
      break;

    case "clear":
      terminal.innerHTML = "";
      break;

    default:
      print(`command not found: ${cmd}`);
  }

  prompt();
}

/* ===== Boot ===== */
print("Web Terminal v1.0", true);
print("Type 'help' to begin.");
prompt();
</script>

</body>
</html>
